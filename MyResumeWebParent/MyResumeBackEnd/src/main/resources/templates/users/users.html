<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">

<head th:replace="fragments :: page_head('Users - MyResume')"></head>
<body>

<div th:replace="navigation :: menu('users')"></div>

<!-- Header -->
<div th:replace="fragments :: header('fas fa-users-cog','Users')"></div>


<!-- Actions -->
<div class="container">
	<div th:if="${flag!=null && flag}"
		 class="alert alert-danger text-center">
		[[${message}]]
	</div>
	<div th:if="${flag!=null && !flag}"
		 class="alert alert-success text-center">
		[[${message}]]
	</div>
</div>

	<div th:replace="fragments :: dynamicCounts(${totalItems},${noOfCol},${activeRecordsCount})"></div>


<section id="about_section_records">
	<div class="container">
		<div class="row">
			<div class="col-md-12">
					<div class="card-header">
						<h4>
							User Records
						</h4>

					</div>
					<div>
						<form id="searchForm" th:action="@{/users/page/1/}" class="form-inline m-3">
							<input type="hidden" name="sortField" th:value="${sortField}"/>
							<input type="hidden" name="sortDir" th:value="${sortDir}"/>
							<h5>Filter:&nbsp</h5>
							<input type="search" name="keyword" th:value="${keyword}"
								   class="form-control search-form mr-2"/>
							<button type="submit" class="btn btn-success"/>
							<i class="fas fa-search"></i>
							</button>
							<button type="button" class="btn btn-danger ml-2" onclick="clearFilter()"/>
							<i class="fas fa-eraser"></i>
							</button>
							<a th:href="@{/about_section/new}">
								<button type="button" class="btn btn-primary ml-2"/>
								<i class="fas fa-plus"></i>
								</button>
							</a>
						</form>
					</div>
					<div class="full-details">
						<table class = "table table-responsive-xl">
							<thead class ="thead-dark">
							<tr>
								<th class="hideable-column col-2">
								<th th:replace="user_fragments :: column_link('id','User id','tag')"/>
								</th>
								<th>Photos</th>
								<th class="hideable-column">
								<th th:replace="user_fragments :: column_link('email','Email','tag')">
								</th>
								<th class="col-2" th:replace="user_fragments :: column_link('firstName','First Name','none')"></th>
								<th class="col-2" th:replace="user_fragments :: column_link('lastName','Last Name','none')"></th>
								<th>Roles</th>
								<th th:replace="user_fragments :: column_link('enabled','Enabled','none')"></th>
								<th class="col-2">Actions</th>
							</tr>
							</thead>
							<tbody>
							<tr th:each="user: ${listUsers}">
								<td class = "hideable-column col-2">[[${user.id}]]</td>
								<td>
									<span th:if="${user.photos ==null}" class = "fas fa-portrait fa-3x icon-silver"></span>
									<img class = "uploadedPhoto" th:if="${user.photos !=null}" th:src = "@{${user.photosImagePath}}"/>
								</td>
								<td class = "hideable-column">[[${user.email}]]</td>
								<td class="col-2">[[${user.firstName}]]</td>
								<td class="col-2">[[${user.lastName}]]</td>
								<td>[[${user.roles}]]</td>

								<td>
									<a th:if="${user.enabled == true}" class = "fas fa-check-circle fa-2x icon-green"
									   th:href="@{'/users/' + ${user.id} + '/enabled/false'}"
									   title = "Disable this user"
									></a>
									<a th:if="${user.enabled != true}" class = "fas fa-circle fa-2x icon-dark"
									   th:href="@{'/users/' + ${user.id} + '/enabled/true'}"
									   title = "Enable this user"
									></a>
								</td>
								<td class="col-2"><a class = "fas fa-edit fa-2x icon-silver" th:href="@{'/users/edit/' + ${user.id}}"
									   title = "Edit the user"></a>
									<a class ="fas fa-trash fa-2x icon-silver link-delete" th:href="@{'/users/delete/' + ${user.id}}"
									   th:userId = "${user.id}"
									   title = "Delete this user"></a>
								</td>
							</tr>

							</tbody>
						</table>

						<div class="text-center m-1">
				<span class="alert alert-danger" th:if="${currentPage > totalPages}">
				No records found
				</span>
							<span th:unless="${currentPage > totalPages}">
		 		Showing records # [[${startCount}]] to [[${endCount}]] of [[${totalItems}]]
		 		</span>
						</div>

					</div>


					<div class="less-details">
						<div th:each="user: ${listUsers}" class="row m-1">
							<div class="col-4">
								<span th:if="${user.photos ==null}" class = "fas fa-portrait fa-3x icon-silver"></span>
								<img class = "uploadedPhoto" th:if="${user.photos !=null}" th:src = "@{${user.photosImagePath}}"/>
							</div>
							<div class="col-8">
								<div><span class="text-primary font-weight-bold">[[${user.fullName}]]</span></div>
								<div><span class="text-primary font-weight-bold">[[${user.roles}]]</span></div>
								<div class="mt-2">
									<a th:if="${user.enabled == true}" class = "fas fa-check-circle fa-2x icon-green"
									   th:href="@{'/users/' + ${user.id} + '/enabled/false'}"
									   title = "Disable this user"
									></a>
									<a th:if="${user.enabled != true}" class = "fas fa-circle fa-2x icon-dark"
									   th:href="@{'/users/' + ${user.id} + '/enabled/true'}"
									   title = "Enable this user"
									></a>
									<a class = "fas fa-edit fa-2x icon-silver" th:href="@{'/users/edit/' + ${user.id}}"
									   title = "Edit the user"></a>
									<a class ="fas fa-trash fa-2x icon-silver link-delete" th:href="@{'/users/delete/' + ${user.id}}"
									   th:userId = "${user.id}"
									   title = "Delete this user"></a>

								</div>
							</div>
							<div>&nbsp;</div>
						</div>
					</div>
					<div  class = "text-center m-1">
		<span class="alert alert-danger" th:if="${currentPage > totalPages}">
		No Users found
		 </span>
						<span th:unless="${currentPage > totalPages}">
		 Showing users # [[${startCount}]] to [[${endCount}]] of [[${totalItems}]]
		 </span>
					</div>
					<div th:if="${totalPages > 1}">

						<nav>
							<ul class="pagination justify-content-center flex-wrap">
								<li th:class ="${currentPage > 1 ? 'page-item': 'page-item disabled'}">
									<a class="page-link" th:href="@{'/users/page/1'+'?sortField=' + ${sortField} + '&sortDir=' + ${sortDir}+${keyword!=null ? '&keyword='+keyword : ''}}">First</a>
								</li>
								<li th:class ="${currentPage > 1 ? 'page-item': 'page-item disabled'}">
									<a class="page-link" th:href="@{'/users/page/'+${currentPage-1}+'?sortField='+${sortField}+'&sortDir='+${sortDir}+${keyword!=null ? '&keyword='+keyword : ''}}">Previous</a>
								</li>
								<li th:class="${currentPage != i ? 'page-item': 'page-item active'}"
									th:each ="i:${#numbers.sequence(1,totalPages)}">
									<a class="page-link" th:href="@{'/users/page/' + ${i} +'?sortField=' + ${sortField} + '&sortDir=' + ${sortDir}+${keyword!=null ? '&keyword='+keyword : ''}}">[[${i}]]</a>
								</li>

								<li th:class ="${currentPage < totalPages ? 'page-item': 'page-item disabled'}">
									<a class="page-link" th:href="@{'/users/page/'+${currentPage+1} +'?sortField=' + ${sortField} + '&sortDir=' + ${sortDir}+${keyword!=null ? '&keyword='+keyword : ''}}">Next</a>
								</li>
								<li th:class ="${currentPage < totalPages ? 'page-item': 'page-item disabled'}">
									<a class="page-link" th:href="@{'/users/page/'+${totalPages} +'?sortField=' + ${sortField} + '&sortDir=' + ${sortDir}+${keyword!=null ? '&keyword='+keyword : ''}}">Last</a>
								</li>
							</ul>
						</nav>
					</div>
			</div>
		</div>
	</div>
</section>

<div class="modal fade text-center" id="confirmModal">
	<div class="modal-dialog">
		<div class="modal-content">
			<div class="modal-header">
				<h4 class="modal-title">Delete Confirmation</h4>
				<button type="button" class="close" data-dismiss="modal">&times;</button>
			</div>

			<div class="modal-body">
				<span id="confirmText"></span>
			</div>

			<div class="modal-footer">
				<a class="btn btn-success" href="" id="yesButton">Yes</a>
				<button type="button" class="btn btn-danger" data-dismiss="modal">No</button>
			</div>
		</div>
	</div>
</div>

<script type="text/javascript">
	$(document).ready(function() {
	$(".link-delete").on("click", function(e){
		e.preventDefault();
		link = $(this);
		userId = link.attr("userId");
		$("#yesButton").attr("href",link.attr("href"));
		$("#confirmText").text("Are you sure you want to delete this user ID " + userId +"?");
		$("#confirmModal").modal();
	});
	});
	
	function clearFilter(){
	window.location = "[[@{/users}]]"
	}
</script>

</body>
</html>