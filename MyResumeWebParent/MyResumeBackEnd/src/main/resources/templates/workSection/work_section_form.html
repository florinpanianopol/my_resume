<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head th:replace="fragments :: page_head(${pageTitle})">


</head>
<body>

<div th:replace="navigation :: menu('work_section')"></div>

<!-- Header -->
<header id="main-header" class="py-2 bg-primary text-white mb-2">
	<div class="container">
		<div class="col-md-12">
			<h1>
				<i class="fas fa-cog"></i>
				Manage Records | [[${pageTitle}]]
			</h1>
		</div>
	</div>
</header>

<div class ="container-fluid">
	<div th:if="${message != null}" class = "alert alert-danger text-center">
		[[${message}]]
	</div>
	<form th:action="@{/work_section/save}" method="post" style="max-width: 700px; margin:0 auto"
		  enctype = "multipart/form-data" th:object="${workSection}">
	<input type="hidden" th:field="*{id}"/>
	<div class = "border p-3">

		<div class = "form-group row">
			<label class = "col-sm-4 col-form-label">Company</label>
			<div class = "col-sm-8">
				<input type="text" class = "form-control" th:field="*{company}" />
				<span th:if="${#fields.hasErrors('company')}" th:errors="*{company}" class="error"></span>
			</div>
		</div>

		<div class = "form-group row">
			<label class = "col-sm-4 col-form-label">Company Logo</label>
			<div class = "col-sm-8">
				<input type = "hidden" th:field="*{companyLogoPhoto}" />
				<input type="file" id="fileImage" name = "image" accept="image/png, image/jpeg, image/jfif"
					   class = "mb-2"/>
				<img id="thumbnail" alt="default picture" th:src="@{${workSection.companyLogoImagePath}}"
					 class = "img-fluid"/>
			</div>
		</div>
		
		<div class = "form-group row">
			<label class = "col-sm-4 col-form-label">Job Name</label>
			<div class = "col-sm-8">
				<input type="text" class = "form-control" th:field="*{jobName}" />
				<span th:if="${#fields.hasErrors('jobName')}" th:errors="*{jobName}" class="error"></span>
				<span th:if="${uniquenessMessage != null}" class="error">[[${uniquenessMessage}]]</span>
			</div>
		</div>
	
		<div class = "form-group row">
			<label class = "col-sm-4 col-form-label">Job Description</label>
			<div class = "col-sm-8">
				<textarea class = "form-control" th:field="*{jobDesc}" rows="5"></textarea>
				<span th:if="${#fields.hasErrors('jobDesc')}" th:errors="*{jobDesc}" class="error"></span>
			</div>
		</div>
		
		<div class = "form-group row">
			<label class = "col-sm-4 col-form-label">Web site</label>
			<div class = "col-sm-8">
				<input type="text" class = "form-control" th:field="*{webSite}" />
				<span th:if="${#fields.hasErrors('webSite')}" th:errors="*{webSite}" class="error"></span>
			</div>
		</div>

		<div class = "form-group row">
			<label class = "col-sm-4 col-form-label">From date</label>
			<div class = "col-sm-8">
				<input type="text" class = "form-control datepicker" th:field="*{fromDate}" />
				<span th:if="${fromDateError != null}" class="error">[[${fromDateError}]]</span>
			</div>

		</div>

		<div class = "form-group row">
			<label class = "col-sm-4 col-form-label">To date</label>
			<div class = "col-sm-8">
				<input type="text" class = "form-control datepicker" th:field="*{toDate}" />
				<span th:if="${toDateError != null}" class="error">[[${toDateError}]]</span>
			</div>
		</div>

		<div class = "form-group row">
			<label class = "col-sm-4 col-form-label">Enabled</label>
			<div class = "col-sm-8">
				<input type="checkbox" th:field="*{enabled}"/>
			</div>
		</div>
		
		<div class = "text-center">
			<input type="submit" value="Save" class = "btn btn-primary m-3"/>
			<input type="button" value="Cancel" class = "btn btn-secondary" id="buttonCancel"/>
		</div>
	</div>
	</form>
</div>

<script type="text/javascript">
	$(document).ready(function(){
		$("#jobDesc").richText();
		$("#buttonCancel").on("click",function(){
			window.location = "[[@{/work_section}]]";
		});

		$("#fileImage").change(function(){
			fileSize = this.files[0].size;


			if(fileSize > 1048576) {

				this.setCustomValidity("You must choose an image less than 1MB");
				this.reportValidity();
			} else {
				this.setCustomValidity("");
				showImageThumbnail(this)
			}
		});
	});

	function showImageThumbnail(fileInput){
		var file = fileInput.files[0];
		var reader = new FileReader();
		reader.onload = function(e) {
			$("#thumbnail").attr("src",e.target.result);
		};

		reader.readAsDataURL(file);
	}
</script>

<script>
	$( function() {
		$( ".datepicker" ).datepicker({ dateFormat: 'yy-mm-dd' });
	} );
</script>

</body>
</html>